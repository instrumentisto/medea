version: '2'

services:
  webclient:
    ports:
      - "3478:3478"      # turn/stun tcp coturn
      - "3478:3478/udp"  # turn/stun udp coturn
      - "9093:9093"
    expose:
      - "9321"          # metrics openvidu
    volumes:
      - ./demo:/usr/share/nginx/html
      - ./demo/node_modules/instrumentisto-browser/static/js:/usr/share/nginx/html/js
  coturn:
    container_name: ${COMPOSE_PROJECT_NAME}-coturn
    image: instrumentisto/coturn:4.5
    depends_on: ["coturn-db"]
    command:
      - --log-file=stdout
    volumes:
      - ../../dev/coturn/turnserver.conf:/etc/coturn/turnserver.conf:ro
      - ../../.cache/coturn/data:/var/lib/coturn
    network_mode: host
  coturn-db:
    container_name: ${COMPOSE_PROJECT_NAME}-coturn-db
    image: redis:alpine
    command: ["redis-server", "/etc/redis.conf"]
    ports:
      - "6379:6379"    # coturn redis
    volumes:
      - ../../dev/coturn/redis.conf:/etc/redis.conf:ro
